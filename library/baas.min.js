var Baas=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Admin=t.MongoClient=t.BaasClient=t.Auth=t.BaasError=t.parseRedirectFragment=t.ErrInvalidSession=t.ErrAuthProviderNotFound=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(1);var a="_baas_ua",u="_baas_rt",c="_baas_state",l="_baas_error",f="_baas_link",h="https://baas-dev.10gen.cc",p=(t.ErrAuthProviderNotFound="AuthProviderNotFound",t.ErrInvalidSession="InvalidSession"),d=64,y=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},v=function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t},b=t.parseRedirectFragment=function(e,t){var r=e.split("&"),n={ua:null,found:!1,stateValid:!1,lastError:null},o=!0,i=!1,s=void 0;try{e:for(var u,h=r[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var p=u.value,d=p.split("="),y=decodeURIComponent(d[0]);switch(y){case l:n.lastError=decodeURIComponent(d[1]),n.found=!0;break e;case a:n.ua=JSON.parse(window.atob(decodeURIComponent(d[1]))),n.found=!0;continue;case f:n.found=!0;continue;case c:n.found=!0;var v=decodeURIComponent(d[1]);t&&t===v&&(n.stateValid=!0)}}}catch(e){i=!0,s=e}finally{try{!o&&h.return&&h.return()}finally{if(i)throw s}}return n},g=t.BaasError=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name="BaasError",i.message=e,void 0!==r&&(i.code=r),"function"==typeof Error.captureStackTrace?Error.captureStackTrace(i,i.constructor):i.stack=new Error(e).stack,i}return i(t,e),t}(Error),m=t.Auth=function(){function e(t){n(this,e),this.rootUrl=t}return s(e,[{key:"pageRootUrl",value:function(){return[window.location.protocol,"//",window.location.host,window.location.pathname].join("")}},{key:"setAccessToken",value:function(e){var t=this.get();t.accessToken=e,t.refreshToken=localStorage.getItem(u),this.set(t)}},{key:"handleRedirect",value:function(){var e=localStorage.getItem(c),t=window.location.hash.substring(1),r=b(t,e);if(r.lastError)return console.error("BaasClient: error from redirect: "+r.lastError),void window.history.replaceState(null,"",this.pageRootUrl());if(r.found){if(localStorage.removeItem(c),!r.stateValid)return console.error("BaasClient: state values did not match!"),void window.history.replaceState(null,"",this.pageRootUrl());if(!r.ua)return void console.error("BaasClient: no UA value was returned from redirect!");this.set(r.ua),window.history.replaceState(null,"",this.pageRootUrl())}}},{key:"getOAuthLoginURL",value:function(t,r){void 0===r&&(r=this.pageRootUrl());var n=e.generateState();localStorage.setItem(c,n);var o=this.rootUrl+"/oauth2/"+t+"?redirect="+encodeURI(r)+"&state="+n;return o}},{key:"localAuth",value:function(e,t,r){var n=this,o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return r&&(o.cors=r),fetch(this.rootUrl+"/local/userpass",o).then(v).then(function(e){return e.json().then(function(e){n.set(e),Promise.resolve()})})}},{key:"clear",value:function(){localStorage.removeItem(a),localStorage.removeItem(u)}},{key:"set",value:function(e){var t=e.refreshToken;delete e.refreshToken,localStorage.setItem(a,window.btoa(JSON.stringify(e))),localStorage.setItem(u,t)}},{key:"get",value:function(){return null===localStorage.getItem(a)?null:JSON.parse(window.atob(localStorage.getItem(a)))}},{key:"authedId",value:function(){var e=this.get();return((e||{}).user||{})._id}}],[{key:"generateState",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=0;r<d;r++){var n=Math.floor(Math.random()*e.length);t+=e.substring(n,n+1)}return t}}]),e}(),_=t.BaasClient=function(){function e(t,r){n(this,e);var o=h;r&&r.baseUrl&&(o=r.baseUrl),this.appUrl=o+"/admin/v1",this.authUrl=o+"/admin/v1/auth",t&&(this.appUrl=o+"/v1/app/"+t,this.authUrl=this.appUrl+"/auth"),this.authManager=new m(this.authUrl),this.authManager.handleRedirect()}return s(e,[{key:"authWithOAuth",value:function(e,t){window.location.replace(this.authManager.getOAuthLoginURL(e,t))}},{key:"authedId",value:function(){return this.authManager.authedId()}},{key:"auth",value:function(){return this.authManager.get()}},{key:"logout",value:function(){var e=this;return this._doAuthed("/auth","DELETE",{refreshOnFailure:!1,useRefreshToken:!0}).then(function(t){e.authManager.clear()})}},{key:"_doAuthed",value:function(e,t,r){var n=this;if(void 0===r?r={refreshOnFailure:!0,useRefreshToken:!1}:(void 0===r.refreshOnFailure&&(r.refreshOnFailure=!0),void 0===r.useRefreshToken&&(r.useRefreshToken=!1)),null===this.auth())return Promise.reject(new g("Must auth first"));var o=""+this.appUrl+e,i={Accept:"application/json","Content-Type":"application/json"},s=r.useRefreshToken?localStorage.getItem(u):this.auth().accessToken;i.Authorization="Bearer "+s;var a={method:t,headers:i};return r.body&&(a.body=r.body),r.queryParams&&(o=o+"?"+y(r.queryParams)),fetch(o,a).then(function(o){if(o.status>=200&&o.status<300)return Promise.resolve(o);if("application/json"===o.headers.get("Content-Type"))return o.json().then(function(i){if("errorCode"in i&&i.errorCode===p){if(!r.refreshOnFailure){n.authManager.clear();var s=new g(i.error,i.errorCode);throw s.response=o,s}return n._refreshToken().then(function(){return r.refreshOnFailure=!1,n._doAuthed(e,t,r)})}var a=new g(i.error,i.errorCode);throw a.response=o,a});var i=new Error(o.statusText);throw i.response=o,i})}},{key:"_refreshToken",value:function(){var e=this;return this._doAuthed("/auth/newAccessToken","POST",{refreshOnFailure:!1,useRefreshToken:!0}).then(function(t){return t.json().then(function(t){return e.authManager.setAccessToken(t.accessToken),Promise.resolve()})})}},{key:"executePipeline",value:function(e){return this._doAuthed("/pipeline","POST",{body:JSON.stringify(e)}).then(function(e){return e.json()})}}]),e}(),w=function(){function e(t,r,o){n(this,e),this.client=t,this.service=r,this.name=o}return s(e,[{key:"getCollection",value:function(e){return new k(this,e)}}]),e}(),k=function(){function e(t,r){n(this,e),this.db=t,this.name=r}return s(e,[{key:"getBaseArgs",value:function(){return{database:this.db.name,collection:this.name}}},{key:"deleteOne",value:function(e){var t=this.getBaseArgs();return t.query=e,t.singleDoc=!0,this.db.client.executePipeline([{service:this.db.service,action:"delete",args:t}])}},{key:"deleteMany",value:function(e){var t=this.getBaseArgs();return t.query=e,t.singleDoc=!1,this.db.client.executePipeline([{service:this.db.service,action:"delete",args:t}])}},{key:"find",value:function(e,t){var r=this.getBaseArgs();return r.query=e,r.project=t,this.db.client.executePipeline([{service:this.db.service,action:"find",args:r}])}},{key:"insert",value:function(e){return this.db.client.executePipeline([{action:"literal",args:{items:e}},{service:this.db.service,action:"insert",args:this.getBaseArgs()}])}},{key:"makeUpdateStage",value:function(e,t,r,n){var o=this.getBaseArgs();return o.query=e,o.update=t,r&&(o.upsert=!0),n&&(o.multi=!0),{service:this.db.service,action:"update",args:o}}},{key:"updateOne",value:function(e,t){return this.db.client.executePipeline([this.makeUpdateStage(e,t,!1,!1)])}},{key:"updateMany",value:function(e,t,r,n){return this.db.client.executePipeline([this.makeUpdateStage(e,t,!1,!0)])}},{key:"upsert",value:function(e,t){return this.db.client.executePipeline([this.makeUpdateStage(e,t,!0,!1)])}}]),e}();t.MongoClient=function(){function e(t,r){n(this,e),this.baasClient=t,this.service=r}return s(e,[{key:"getDb",value:function(e){return new w(this.baasClient,this.service,e)}}]),e}(),t.Admin=function(){function e(t){n(this,e),this.client=new _("",{baseUrl:t})}return s(e,[{key:"_doAuthed",value:function(e,t,r){return this.client._doAuthed(e,t,r).then(function(e){return e.json()})}},{key:"_get",value:function(e,t){return this._doAuthed(e,"GET",{queryParams:t})}},{key:"_put",value:function(e,t){return this._doAuthed(e,"PUT",{queryParams:t})}},{key:"_delete",value:function(e){return this._doAuthed(e,"DELETE")}},{key:"_post",value:function(e,t){return this._doAuthed(e,"POST",{body:JSON.stringify(t)})}},{key:"profile",value:function(){var e=this,t=this;return{keys:function(){return{list:function(){return t._get("/profile/keys")},create:function(e){return t._post("/profile/keys")},apiKey:function(r){return{get:function(){return t._get("/profile/keys/"+r)},remove:function(){return e._delete("/profile/keys/"+r)},enable:function(){return t._put("/profile/keys/"+r+"/enable")},disable:function(){return t._put("/profile/keys/"+r+"/disable")}}}}}}}},{key:"apps",value:function(){var e=this,t=this;return{list:function(){return t._get("/apps")},create:function(e){return t._post("/apps",e)},app:function(r){return{get:function(){return t._get("/apps/"+r)},remove:function(){return t._delete("/apps/"+r)},users:function(){return{list:function(t){return e._get("/apps/"+r+"/users",t)},user:function(t){return{get:function(){return e._get("/apps/"+r+"/users/"+t)}}}}},authProviders:function(){return{create:function(t){return e._post("/apps/"+r+"/authProviders",t)},list:function(){return e._get("/apps/"+r+"/authProviders")},provider:function(t,n){return{get:function(){return e._get("/apps/"+r+"/authProviders/"+t+"/"+n)},remove:function(){return e._delete("/apps/"+r+"/authProviders/"+t+"/"+n)},update:function(o){return e._post("/apps/"+r+"/authProviders/"+t+"/"+n,o)}}}}},variables:function(){return{list:function(){return e._get("/apps/"+r+"/vars")},create:function(t){return e._post("/apps/"+r+"/vars",t)},variable:function(t){return{get:function(){return e._get("/apps/"+r+"/vars/"+t)},remove:function(){return e._delete("/apps/"+r+"/vars/"+t)},update:function(n){return e._post("/apps/"+r+"/vars/"+t,n)}}}}},logs:function(){return{get:function(t){return e._get("/apps/"+r+"/logs",t)}}},apiKeys:function(){return{list:function(){return e._get("/apps/"+r+"/keys")},create:function(t){return e._post("/apps/"+r+"/keys",t)},apiKey:function(t){return{get:function(){return e._get("/apps/"+r+"/keys/"+t)},remove:function(){return e._delete("/apps/"+r+"/keys/"+t)},enable:function(){return e._put("/apps/"+r+"/keys/"+t+"/enable")},disable:function(){return e._put("/apps/"+r+"/keys/"+t+"/disable")}}}}},services:function(){return{list:function(){return e._get("/apps/"+r+"/services")},create:function(t){return e._post("/apps/"+r+"/services",t)},service:function(t){return{get:function(){return e._get("/apps/"+r+"/services/"+t)},update:function(n){return e._post("/apps/"+r+"/services/"+t,n)},remove:function(){return e._delete("/apps/"+r+"/services/"+t)},setConfig:function(n){return e._post("/apps/"+r+"/services/"+t+"/config",n)},rules:function(){return{list:function(){return e._get("/apps/"+r+"/services/"+t+"/rules")},create:function(n){return e._post("/apps/"+r+"/services/"+t+"/rules")},rule:function(n){return{get:function(){return e._get("/apps/"+r+"/services/"+t+"/rules/"+n)},update:function(o){return e._post("/apps/"+r+"/services/"+t+"/rules/"+n,o)},remove:function(){return e._delete("/apps/"+r+"/services/"+t+"/rules/"+n)}}}}},triggers:function(){return{list:function(){return e._get("/apps/"+r+"/services/"+t+"/triggers")},create:function(n){return e._post("/apps/"+r+"/services/"+t+"/triggers")},trigger:function(n){return{get:function(){return e._get("/apps/"+r+"/services/"+t+"/triggers/"+n)},update:function(o){return e._post("/apps/"+r+"/services/"+t+"/triggers/"+n,o)},remove:function(){return e._delete("/apps/"+r+"/services/"+t+"/triggers/"+n)}}}}}}}}}}}}}}]),e}()},function(e,t){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return b.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function i(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=s(t);return t.readAsArrayBuffer(e),r}function u(e){var t=new FileReader,r=s(t);return t.readAsText(e),r}function c(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function l(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(b.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(b.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(b.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(b.arrayBuffer&&b.blob&&m(e))this._bodyArrayBuffer=l(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!b.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!_(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):b.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},b.blob&&(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},b.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function p(e,t){t=t||{};var r=t.body;if(e instanceof p){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=h(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function y(e){var t=new o;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new o(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var b={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(b.arrayBuffer)var g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],m=function(e){return e&&DataView.prototype.isPrototypeOf(e)},_=ArrayBuffer.isView||function(e){return e&&g.indexOf(Object.prototype.toString.call(e))>-1};o.prototype.append=function(e,n){e=t(e),n=r(n);var o=this.map[e];this.map[e]=o?o+","+n:n},o.prototype.delete=function(e){delete this.map[t(e)]},o.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},o.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},o.prototype.set=function(e,n){this.map[t(e)]=r(n)},o.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},b.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this,{body:this._bodyInit})},f.call(p.prototype),f.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var k=[301,302,303,307,308];v.redirect=function(e,t){if(k.indexOf(t)===-1)throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=o,e.Request=p,e.Response=v,e.fetch=function(e,t){return new Promise(function(r,n){var o=new p(e,t),i=new XMLHttpRequest;i.onload=function(){var e={status:i.status,statusText:i.statusText,headers:y(i.getAllResponseHeaders()||"")};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new v(t,e))},i.onerror=function(){n(new TypeError("Network request failed"))},i.ontimeout=function(){n(new TypeError("Network request failed"))},i.open(o.method,o.url,!0),"include"===o.credentials&&(i.withCredentials=!0),"responseType"in i&&b.blob&&(i.responseType="blob"),o.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send("undefined"==typeof o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)}]);
//# sourceMappingURL=baas.min.js.map